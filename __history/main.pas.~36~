unit main;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.StdCtrls, ComObj, Vcl.Grids, DateUtils;

type
  TMainForm = class(TForm)
    BtnConf: TButton;
    BtnSend: TButton;
    StringGridChannels: TStringGrid;
    procedure BtnSendClick(Sender: TObject);
    function FormatingDateTime(s: string): TDateTime;
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  MainForm: TMainForm;

implementation

{$R *.dfm}

procedure TMainForm.BtnSendClick(Sender: TObject);
const
  xlCellTypeLastCell = $0000000B;
var
  ExcelApp, ExcelSheet: OLEVariant;
  ChannelsSrc: Variant;
  x, y: Integer;
  d: TDateTime;
begin
  // создание OLE-объекта Excel
  ExcelApp := CreateOleObject('Excel.Application');

  // открытие книги Excel
  ExcelApp.Workbooks.Open('E:\Develop\Delphi\onlineoo_export_OMG_smolensk-3.XLS');

  // открытие листа книги
  ExcelSheet := ExcelApp.Workbooks[1].WorkSheets[1];

  // выделение последней задействованной ячейки на листе
  ExcelSheet.Cells.SpecialCells(xlCellTypeLastCell).Activate;

  // получение значений размера выбранного диапазона
  x := ExcelApp.ActiveCell.Row;
  y := ExcelApp.ActiveCell.Column;

  // присвоение массиву диапазона ячеек на листе
  ChannelsSrc := ExcelApp.Range['A1', ExcelApp.Cells.Item[X, Y]].Value;

  // закрытие книги и очистка переменных
  ExcelApp.Quit;
  ExcelApp := Unassigned;
  ExcelSheet := Unassigned;

  // назначение размера StringGrid по размеру полученного диапазона ячеек
  StringGridChannels.RowCount := x;
  StringGridChannels.ColCount := y;

  // заполнение таблицы StringGrid значениями массива
  for x := 1 to StringGridChannels.ColCount do
    for y := 1 to StringGridChannels.RowCount do
      StringGridChannels.Cells[x-1, y-1] := ChannelsSrc[y, x];

 // ShowMessage(intToStr(DaysBetween(Now, FormatingDateTime(StringGridChannels.Cells[5,1]))));
  ShowMessage(DateTimeToStr(Now));
  ShowMessage(DateTimeToStr(FormatingDateTime(StringGridChannels.Cells[5,1])));

end;


function TMainForm.FormatingDateTime(s: string): TDateTime;
var s2: string;
x: integer;
begin
  s2:='';
  s2:=s2+s[9];
  s2:=s2+s[10];
  s2:=s2+'.';
  s2:=s2+s[6];
  s2:=s2+s[7];
  s2:=s2+'.';
  s2:=s2+s[1];
  s2:=s2+s[2];
  s2:=s2+s[3];
  s2:=s2+s[4];
  s2:=s2+' ';
  for x := 12 to 19 do s2:=s2+s[x];
  result:=StrToDateTime(s2);
end;


end.
